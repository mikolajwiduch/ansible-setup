- name: Cleanup all Docker resources
  hosts: all
  become: true
  tasks:
    - name: Stop and remove all containers
      shell: docker rm -f $(docker ps -aq)
      ignore_errors: true

    - name: Remove Swarm network
      command: docker network rm "{{ swarm_network_name }}"
      ignore_errors: true

    - name: Leave Docker Swarm
      shell: docker swarm leave --force
      ignore_errors: true

- name: Leave Swarm (non-leader nodes only)
  hosts: all:!webservers[0]
  become: true
  tasks:
    - name: Leave Docker Swarm
      command: docker swarm leave --force
      ignore_errors: true
      changed_when: false

- name: Leave Swarm (leader node)
  hosts: webservers[0]
  become: true
  tasks:
    - name: Leave Docker Swarm
      command: docker swarm leave --force
      ignore_errors: true
      changed_when: false